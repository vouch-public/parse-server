"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EventEmitterPubSub = void 0;
var _events = _interopRequireDefault(require("events"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const emitter = new _events.default.EventEmitter();
class Publisher {
  constructor(emitter) {
    this.emitter = emitter;
  }
  publish(channel, message) {
    this.emitter.emit(channel, message);
  }
}
class Subscriber extends _events.default.EventEmitter {
  constructor(emitter) {
    super();
    this.emitter = emitter;
    this.subscriptions = new Map();
  }
  subscribe(channel) {
    const handler = message => {
      this.emit('message', channel, message);
    };
    this.subscriptions.set(channel, handler);
    this.emitter.on(channel, handler);
  }
  unsubscribe(channel) {
    if (!this.subscriptions.has(channel)) {
      return;
    }
    this.emitter.removeListener(channel, this.subscriptions.get(channel));
    this.subscriptions.delete(channel);
  }
}
function createPublisher() {
  return new Publisher(emitter);
}
function createSubscriber() {
  // createSubscriber is called once at live query server start
  // to avoid max listeners warning, we should clean up the event emitter
  // each time this function is called
  emitter.removeAllListeners();
  return new Subscriber(emitter);
}
const EventEmitterPubSub = {
  createPublisher,
  createSubscriber
};
exports.EventEmitterPubSub = EventEmitterPubSub;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlbWl0dGVyIiwiZXZlbnRzIiwiRXZlbnRFbWl0dGVyIiwiUHVibGlzaGVyIiwiY29uc3RydWN0b3IiLCJwdWJsaXNoIiwiY2hhbm5lbCIsIm1lc3NhZ2UiLCJlbWl0IiwiU3Vic2NyaWJlciIsInN1YnNjcmlwdGlvbnMiLCJNYXAiLCJzdWJzY3JpYmUiLCJoYW5kbGVyIiwic2V0Iiwib24iLCJ1bnN1YnNjcmliZSIsImhhcyIsInJlbW92ZUxpc3RlbmVyIiwiZ2V0IiwiZGVsZXRlIiwiY3JlYXRlUHVibGlzaGVyIiwiY3JlYXRlU3Vic2NyaWJlciIsInJlbW92ZUFsbExpc3RlbmVycyIsIkV2ZW50RW1pdHRlclB1YlN1YiJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9QdWJTdWIvRXZlbnRFbWl0dGVyUHViU3ViLmpzIl0sInNvdXJjZXNDb250ZW50IjpbImltcG9ydCBldmVudHMgZnJvbSAnZXZlbnRzJztcblxuY29uc3QgZW1pdHRlciA9IG5ldyBldmVudHMuRXZlbnRFbWl0dGVyKCk7XG5cbmNsYXNzIFB1Ymxpc2hlciB7XG4gIGVtaXR0ZXI6IGFueTtcblxuICBjb25zdHJ1Y3RvcihlbWl0dGVyOiBhbnkpIHtcbiAgICB0aGlzLmVtaXR0ZXIgPSBlbWl0dGVyO1xuICB9XG5cbiAgcHVibGlzaChjaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuZW1pdHRlci5lbWl0KGNoYW5uZWwsIG1lc3NhZ2UpO1xuICB9XG59XG5cbmNsYXNzIFN1YnNjcmliZXIgZXh0ZW5kcyBldmVudHMuRXZlbnRFbWl0dGVyIHtcbiAgZW1pdHRlcjogYW55O1xuICBzdWJzY3JpcHRpb25zOiBhbnk7XG5cbiAgY29uc3RydWN0b3IoZW1pdHRlcjogYW55KSB7XG4gICAgc3VwZXIoKTtcbiAgICB0aGlzLmVtaXR0ZXIgPSBlbWl0dGVyO1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucyA9IG5ldyBNYXAoKTtcbiAgfVxuXG4gIHN1YnNjcmliZShjaGFubmVsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICBjb25zdCBoYW5kbGVyID0gbWVzc2FnZSA9PiB7XG4gICAgICB0aGlzLmVtaXQoJ21lc3NhZ2UnLCBjaGFubmVsLCBtZXNzYWdlKTtcbiAgICB9O1xuICAgIHRoaXMuc3Vic2NyaXB0aW9ucy5zZXQoY2hhbm5lbCwgaGFuZGxlcik7XG4gICAgdGhpcy5lbWl0dGVyLm9uKGNoYW5uZWwsIGhhbmRsZXIpO1xuICB9XG5cbiAgdW5zdWJzY3JpYmUoY2hhbm5lbDogc3RyaW5nKTogdm9pZCB7XG4gICAgaWYgKCF0aGlzLnN1YnNjcmlwdGlvbnMuaGFzKGNoYW5uZWwpKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuICAgIHRoaXMuZW1pdHRlci5yZW1vdmVMaXN0ZW5lcihjaGFubmVsLCB0aGlzLnN1YnNjcmlwdGlvbnMuZ2V0KGNoYW5uZWwpKTtcbiAgICB0aGlzLnN1YnNjcmlwdGlvbnMuZGVsZXRlKGNoYW5uZWwpO1xuICB9XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVB1Ymxpc2hlcigpOiBhbnkge1xuICByZXR1cm4gbmV3IFB1Ymxpc2hlcihlbWl0dGVyKTtcbn1cblxuZnVuY3Rpb24gY3JlYXRlU3Vic2NyaWJlcigpOiBhbnkge1xuICAvLyBjcmVhdGVTdWJzY3JpYmVyIGlzIGNhbGxlZCBvbmNlIGF0IGxpdmUgcXVlcnkgc2VydmVyIHN0YXJ0XG4gIC8vIHRvIGF2b2lkIG1heCBsaXN0ZW5lcnMgd2FybmluZywgd2Ugc2hvdWxkIGNsZWFuIHVwIHRoZSBldmVudCBlbWl0dGVyXG4gIC8vIGVhY2ggdGltZSB0aGlzIGZ1bmN0aW9uIGlzIGNhbGxlZFxuICBlbWl0dGVyLnJlbW92ZUFsbExpc3RlbmVycygpO1xuICByZXR1cm4gbmV3IFN1YnNjcmliZXIoZW1pdHRlcik7XG59XG5cbmNvbnN0IEV2ZW50RW1pdHRlclB1YlN1YiA9IHtcbiAgY3JlYXRlUHVibGlzaGVyLFxuICBjcmVhdGVTdWJzY3JpYmVyLFxufTtcblxuZXhwb3J0IHsgRXZlbnRFbWl0dGVyUHViU3ViIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQTRCO0FBRTVCLE1BQU1BLE9BQU8sR0FBRyxJQUFJQyxlQUFNLENBQUNDLFlBQVksRUFBRTtBQUV6QyxNQUFNQyxTQUFTLENBQUM7RUFHZEMsV0FBVyxDQUFDSixPQUFZLEVBQUU7SUFDeEIsSUFBSSxDQUFDQSxPQUFPLEdBQUdBLE9BQU87RUFDeEI7RUFFQUssT0FBTyxDQUFDQyxPQUFlLEVBQUVDLE9BQWUsRUFBUTtJQUM5QyxJQUFJLENBQUNQLE9BQU8sQ0FBQ1EsSUFBSSxDQUFDRixPQUFPLEVBQUVDLE9BQU8sQ0FBQztFQUNyQztBQUNGO0FBRUEsTUFBTUUsVUFBVSxTQUFTUixlQUFNLENBQUNDLFlBQVksQ0FBQztFQUkzQ0UsV0FBVyxDQUFDSixPQUFZLEVBQUU7SUFDeEIsS0FBSyxFQUFFO0lBQ1AsSUFBSSxDQUFDQSxPQUFPLEdBQUdBLE9BQU87SUFDdEIsSUFBSSxDQUFDVSxhQUFhLEdBQUcsSUFBSUMsR0FBRyxFQUFFO0VBQ2hDO0VBRUFDLFNBQVMsQ0FBQ04sT0FBZSxFQUFRO0lBQy9CLE1BQU1PLE9BQU8sR0FBR04sT0FBTyxJQUFJO01BQ3pCLElBQUksQ0FBQ0MsSUFBSSxDQUFDLFNBQVMsRUFBRUYsT0FBTyxFQUFFQyxPQUFPLENBQUM7SUFDeEMsQ0FBQztJQUNELElBQUksQ0FBQ0csYUFBYSxDQUFDSSxHQUFHLENBQUNSLE9BQU8sRUFBRU8sT0FBTyxDQUFDO0lBQ3hDLElBQUksQ0FBQ2IsT0FBTyxDQUFDZSxFQUFFLENBQUNULE9BQU8sRUFBRU8sT0FBTyxDQUFDO0VBQ25DO0VBRUFHLFdBQVcsQ0FBQ1YsT0FBZSxFQUFRO0lBQ2pDLElBQUksQ0FBQyxJQUFJLENBQUNJLGFBQWEsQ0FBQ08sR0FBRyxDQUFDWCxPQUFPLENBQUMsRUFBRTtNQUNwQztJQUNGO0lBQ0EsSUFBSSxDQUFDTixPQUFPLENBQUNrQixjQUFjLENBQUNaLE9BQU8sRUFBRSxJQUFJLENBQUNJLGFBQWEsQ0FBQ1MsR0FBRyxDQUFDYixPQUFPLENBQUMsQ0FBQztJQUNyRSxJQUFJLENBQUNJLGFBQWEsQ0FBQ1UsTUFBTSxDQUFDZCxPQUFPLENBQUM7RUFDcEM7QUFDRjtBQUVBLFNBQVNlLGVBQWUsR0FBUTtFQUM5QixPQUFPLElBQUlsQixTQUFTLENBQUNILE9BQU8sQ0FBQztBQUMvQjtBQUVBLFNBQVNzQixnQkFBZ0IsR0FBUTtFQUMvQjtFQUNBO0VBQ0E7RUFDQXRCLE9BQU8sQ0FBQ3VCLGtCQUFrQixFQUFFO0VBQzVCLE9BQU8sSUFBSWQsVUFBVSxDQUFDVCxPQUFPLENBQUM7QUFDaEM7QUFFQSxNQUFNd0Isa0JBQWtCLEdBQUc7RUFDekJILGVBQWU7RUFDZkM7QUFDRixDQUFDO0FBQUMifQ==