"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.default = exports.InMemoryCache = void 0;
const DEFAULT_CACHE_TTL = 5 * 1000;
class InMemoryCache {
  constructor({
    ttl = DEFAULT_CACHE_TTL
  }) {
    this.ttl = ttl;
    this.cache = Object.create(null);
  }
  get(key) {
    const record = this.cache[key];
    if (record == null) {
      return null;
    }

    // Has Record and isnt expired
    if (isNaN(record.expire) || record.expire >= Date.now()) {
      return record.value;
    }

    // Record has expired
    delete this.cache[key];
    return null;
  }
  put(key, value, ttl = this.ttl) {
    if (ttl < 0 || isNaN(ttl)) {
      ttl = NaN;
    }
    var record = {
      value: value,
      expire: ttl + Date.now()
    };
    if (!isNaN(record.expire)) {
      record.timeout = setTimeout(() => {
        this.del(key);
      }, ttl);
    }
    this.cache[key] = record;
  }
  del(key) {
    var record = this.cache[key];
    if (record == null) {
      return;
    }
    if (record.timeout) {
      clearTimeout(record.timeout);
    }
    delete this.cache[key];
  }
  clear() {
    this.cache = Object.create(null);
  }
}
exports.InMemoryCache = InMemoryCache;
var _default = InMemoryCache;
exports.default = _default;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJERUZBVUxUX0NBQ0hFX1RUTCIsIkluTWVtb3J5Q2FjaGUiLCJjb25zdHJ1Y3RvciIsInR0bCIsImNhY2hlIiwiT2JqZWN0IiwiY3JlYXRlIiwiZ2V0Iiwia2V5IiwicmVjb3JkIiwiaXNOYU4iLCJleHBpcmUiLCJEYXRlIiwibm93IiwidmFsdWUiLCJwdXQiLCJOYU4iLCJ0aW1lb3V0Iiwic2V0VGltZW91dCIsImRlbCIsImNsZWFyVGltZW91dCIsImNsZWFyIl0sInNvdXJjZXMiOlsiLi4vLi4vLi4vc3JjL0FkYXB0ZXJzL0NhY2hlL0luTWVtb3J5Q2FjaGUuanMiXSwic291cmNlc0NvbnRlbnQiOlsiY29uc3QgREVGQVVMVF9DQUNIRV9UVEwgPSA1ICogMTAwMDtcblxuZXhwb3J0IGNsYXNzIEluTWVtb3J5Q2FjaGUge1xuICBjb25zdHJ1Y3Rvcih7IHR0bCA9IERFRkFVTFRfQ0FDSEVfVFRMIH0pIHtcbiAgICB0aGlzLnR0bCA9IHR0bDtcbiAgICB0aGlzLmNhY2hlID0gT2JqZWN0LmNyZWF0ZShudWxsKTtcbiAgfVxuXG4gIGdldChrZXkpIHtcbiAgICBjb25zdCByZWNvcmQgPSB0aGlzLmNhY2hlW2tleV07XG4gICAgaWYgKHJlY29yZCA9PSBudWxsKSB7XG4gICAgICByZXR1cm4gbnVsbDtcbiAgICB9XG5cbiAgICAvLyBIYXMgUmVjb3JkIGFuZCBpc250IGV4cGlyZWRcbiAgICBpZiAoaXNOYU4ocmVjb3JkLmV4cGlyZSkgfHwgcmVjb3JkLmV4cGlyZSA+PSBEYXRlLm5vdygpKSB7XG4gICAgICByZXR1cm4gcmVjb3JkLnZhbHVlO1xuICAgIH1cblxuICAgIC8vIFJlY29yZCBoYXMgZXhwaXJlZFxuICAgIGRlbGV0ZSB0aGlzLmNhY2hlW2tleV07XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cblxuICBwdXQoa2V5LCB2YWx1ZSwgdHRsID0gdGhpcy50dGwpIHtcbiAgICBpZiAodHRsIDwgMCB8fCBpc05hTih0dGwpKSB7XG4gICAgICB0dGwgPSBOYU47XG4gICAgfVxuXG4gICAgdmFyIHJlY29yZCA9IHtcbiAgICAgIHZhbHVlOiB2YWx1ZSxcbiAgICAgIGV4cGlyZTogdHRsICsgRGF0ZS5ub3coKSxcbiAgICB9O1xuXG4gICAgaWYgKCFpc05hTihyZWNvcmQuZXhwaXJlKSkge1xuICAgICAgcmVjb3JkLnRpbWVvdXQgPSBzZXRUaW1lb3V0KCgpID0+IHtcbiAgICAgICAgdGhpcy5kZWwoa2V5KTtcbiAgICAgIH0sIHR0bCk7XG4gICAgfVxuXG4gICAgdGhpcy5jYWNoZVtrZXldID0gcmVjb3JkO1xuICB9XG5cbiAgZGVsKGtleSkge1xuICAgIHZhciByZWNvcmQgPSB0aGlzLmNhY2hlW2tleV07XG4gICAgaWYgKHJlY29yZCA9PSBudWxsKSB7XG4gICAgICByZXR1cm47XG4gICAgfVxuXG4gICAgaWYgKHJlY29yZC50aW1lb3V0KSB7XG4gICAgICBjbGVhclRpbWVvdXQocmVjb3JkLnRpbWVvdXQpO1xuICAgIH1cbiAgICBkZWxldGUgdGhpcy5jYWNoZVtrZXldO1xuICB9XG5cbiAgY2xlYXIoKSB7XG4gICAgdGhpcy5jYWNoZSA9IE9iamVjdC5jcmVhdGUobnVsbCk7XG4gIH1cbn1cblxuZXhwb3J0IGRlZmF1bHQgSW5NZW1vcnlDYWNoZTtcbiJdLCJtYXBwaW5ncyI6Ijs7Ozs7O0FBQUEsTUFBTUEsaUJBQWlCLEdBQUcsQ0FBQyxHQUFHLElBQUk7QUFFM0IsTUFBTUMsYUFBYSxDQUFDO0VBQ3pCQyxXQUFXLENBQUM7SUFBRUMsR0FBRyxHQUFHSDtFQUFrQixDQUFDLEVBQUU7SUFDdkMsSUFBSSxDQUFDRyxHQUFHLEdBQUdBLEdBQUc7SUFDZCxJQUFJLENBQUNDLEtBQUssR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDO0VBQ2xDO0VBRUFDLEdBQUcsQ0FBQ0MsR0FBRyxFQUFFO0lBQ1AsTUFBTUMsTUFBTSxHQUFHLElBQUksQ0FBQ0wsS0FBSyxDQUFDSSxHQUFHLENBQUM7SUFDOUIsSUFBSUMsTUFBTSxJQUFJLElBQUksRUFBRTtNQUNsQixPQUFPLElBQUk7SUFDYjs7SUFFQTtJQUNBLElBQUlDLEtBQUssQ0FBQ0QsTUFBTSxDQUFDRSxNQUFNLENBQUMsSUFBSUYsTUFBTSxDQUFDRSxNQUFNLElBQUlDLElBQUksQ0FBQ0MsR0FBRyxFQUFFLEVBQUU7TUFDdkQsT0FBT0osTUFBTSxDQUFDSyxLQUFLO0lBQ3JCOztJQUVBO0lBQ0EsT0FBTyxJQUFJLENBQUNWLEtBQUssQ0FBQ0ksR0FBRyxDQUFDO0lBQ3RCLE9BQU8sSUFBSTtFQUNiO0VBRUFPLEdBQUcsQ0FBQ1AsR0FBRyxFQUFFTSxLQUFLLEVBQUVYLEdBQUcsR0FBRyxJQUFJLENBQUNBLEdBQUcsRUFBRTtJQUM5QixJQUFJQSxHQUFHLEdBQUcsQ0FBQyxJQUFJTyxLQUFLLENBQUNQLEdBQUcsQ0FBQyxFQUFFO01BQ3pCQSxHQUFHLEdBQUdhLEdBQUc7SUFDWDtJQUVBLElBQUlQLE1BQU0sR0FBRztNQUNYSyxLQUFLLEVBQUVBLEtBQUs7TUFDWkgsTUFBTSxFQUFFUixHQUFHLEdBQUdTLElBQUksQ0FBQ0MsR0FBRztJQUN4QixDQUFDO0lBRUQsSUFBSSxDQUFDSCxLQUFLLENBQUNELE1BQU0sQ0FBQ0UsTUFBTSxDQUFDLEVBQUU7TUFDekJGLE1BQU0sQ0FBQ1EsT0FBTyxHQUFHQyxVQUFVLENBQUMsTUFBTTtRQUNoQyxJQUFJLENBQUNDLEdBQUcsQ0FBQ1gsR0FBRyxDQUFDO01BQ2YsQ0FBQyxFQUFFTCxHQUFHLENBQUM7SUFDVDtJQUVBLElBQUksQ0FBQ0MsS0FBSyxDQUFDSSxHQUFHLENBQUMsR0FBR0MsTUFBTTtFQUMxQjtFQUVBVSxHQUFHLENBQUNYLEdBQUcsRUFBRTtJQUNQLElBQUlDLE1BQU0sR0FBRyxJQUFJLENBQUNMLEtBQUssQ0FBQ0ksR0FBRyxDQUFDO0lBQzVCLElBQUlDLE1BQU0sSUFBSSxJQUFJLEVBQUU7TUFDbEI7SUFDRjtJQUVBLElBQUlBLE1BQU0sQ0FBQ1EsT0FBTyxFQUFFO01BQ2xCRyxZQUFZLENBQUNYLE1BQU0sQ0FBQ1EsT0FBTyxDQUFDO0lBQzlCO0lBQ0EsT0FBTyxJQUFJLENBQUNiLEtBQUssQ0FBQ0ksR0FBRyxDQUFDO0VBQ3hCO0VBRUFhLEtBQUssR0FBRztJQUNOLElBQUksQ0FBQ2pCLEtBQUssR0FBR0MsTUFBTSxDQUFDQyxNQUFNLENBQUMsSUFBSSxDQUFDO0VBQ2xDO0FBQ0Y7QUFBQztBQUFBLGVBRWNMLGFBQWE7QUFBQSJ9