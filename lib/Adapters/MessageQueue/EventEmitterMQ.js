"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.EventEmitterMQ = void 0;
var _events = _interopRequireDefault(require("events"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
const emitter = new _events.default.EventEmitter();
const subscriptions = new Map();
function unsubscribe(channel) {
  if (!subscriptions.has(channel)) {
    //console.log('No channel to unsub from');
    return;
  }
  //console.log('unsub ', channel);
  emitter.removeListener(channel, subscriptions.get(channel));
  subscriptions.delete(channel);
}
class Publisher {
  constructor(emitter) {
    this.emitter = emitter;
  }
  publish(channel, message) {
    this.emitter.emit(channel, message);
  }
}
class Consumer extends _events.default.EventEmitter {
  constructor(emitter) {
    super();
    this.emitter = emitter;
  }
  subscribe(channel) {
    unsubscribe(channel);
    const handler = message => {
      this.emit('message', channel, message);
    };
    subscriptions.set(channel, handler);
    this.emitter.on(channel, handler);
  }
  unsubscribe(channel) {
    unsubscribe(channel);
  }
}
function createPublisher() {
  return new Publisher(emitter);
}
function createSubscriber() {
  return new Consumer(emitter);
}
const EventEmitterMQ = {
  createPublisher,
  createSubscriber
};
exports.EventEmitterMQ = EventEmitterMQ;
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJlbWl0dGVyIiwiZXZlbnRzIiwiRXZlbnRFbWl0dGVyIiwic3Vic2NyaXB0aW9ucyIsIk1hcCIsInVuc3Vic2NyaWJlIiwiY2hhbm5lbCIsImhhcyIsInJlbW92ZUxpc3RlbmVyIiwiZ2V0IiwiZGVsZXRlIiwiUHVibGlzaGVyIiwiY29uc3RydWN0b3IiLCJwdWJsaXNoIiwibWVzc2FnZSIsImVtaXQiLCJDb25zdW1lciIsInN1YnNjcmliZSIsImhhbmRsZXIiLCJzZXQiLCJvbiIsImNyZWF0ZVB1Ymxpc2hlciIsImNyZWF0ZVN1YnNjcmliZXIiLCJFdmVudEVtaXR0ZXJNUSJdLCJzb3VyY2VzIjpbIi4uLy4uLy4uL3NyYy9BZGFwdGVycy9NZXNzYWdlUXVldWUvRXZlbnRFbWl0dGVyTVEuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IGV2ZW50cyBmcm9tICdldmVudHMnO1xuXG5jb25zdCBlbWl0dGVyID0gbmV3IGV2ZW50cy5FdmVudEVtaXR0ZXIoKTtcbmNvbnN0IHN1YnNjcmlwdGlvbnMgPSBuZXcgTWFwKCk7XG5cbmZ1bmN0aW9uIHVuc3Vic2NyaWJlKGNoYW5uZWw6IHN0cmluZykge1xuICBpZiAoIXN1YnNjcmlwdGlvbnMuaGFzKGNoYW5uZWwpKSB7XG4gICAgLy9jb25zb2xlLmxvZygnTm8gY2hhbm5lbCB0byB1bnN1YiBmcm9tJyk7XG4gICAgcmV0dXJuO1xuICB9XG4gIC8vY29uc29sZS5sb2coJ3Vuc3ViICcsIGNoYW5uZWwpO1xuICBlbWl0dGVyLnJlbW92ZUxpc3RlbmVyKGNoYW5uZWwsIHN1YnNjcmlwdGlvbnMuZ2V0KGNoYW5uZWwpKTtcbiAgc3Vic2NyaXB0aW9ucy5kZWxldGUoY2hhbm5lbCk7XG59XG5cbmNsYXNzIFB1Ymxpc2hlciB7XG4gIGVtaXR0ZXI6IGFueTtcblxuICBjb25zdHJ1Y3RvcihlbWl0dGVyOiBhbnkpIHtcbiAgICB0aGlzLmVtaXR0ZXIgPSBlbWl0dGVyO1xuICB9XG5cbiAgcHVibGlzaChjaGFubmVsOiBzdHJpbmcsIG1lc3NhZ2U6IHN0cmluZyk6IHZvaWQge1xuICAgIHRoaXMuZW1pdHRlci5lbWl0KGNoYW5uZWwsIG1lc3NhZ2UpO1xuICB9XG59XG5cbmNsYXNzIENvbnN1bWVyIGV4dGVuZHMgZXZlbnRzLkV2ZW50RW1pdHRlciB7XG4gIGVtaXR0ZXI6IGFueTtcblxuICBjb25zdHJ1Y3RvcihlbWl0dGVyOiBhbnkpIHtcbiAgICBzdXBlcigpO1xuICAgIHRoaXMuZW1pdHRlciA9IGVtaXR0ZXI7XG4gIH1cblxuICBzdWJzY3JpYmUoY2hhbm5lbDogc3RyaW5nKTogdm9pZCB7XG4gICAgdW5zdWJzY3JpYmUoY2hhbm5lbCk7XG4gICAgY29uc3QgaGFuZGxlciA9IG1lc3NhZ2UgPT4ge1xuICAgICAgdGhpcy5lbWl0KCdtZXNzYWdlJywgY2hhbm5lbCwgbWVzc2FnZSk7XG4gICAgfTtcbiAgICBzdWJzY3JpcHRpb25zLnNldChjaGFubmVsLCBoYW5kbGVyKTtcbiAgICB0aGlzLmVtaXR0ZXIub24oY2hhbm5lbCwgaGFuZGxlcik7XG4gIH1cblxuICB1bnN1YnNjcmliZShjaGFubmVsOiBzdHJpbmcpOiB2b2lkIHtcbiAgICB1bnN1YnNjcmliZShjaGFubmVsKTtcbiAgfVxufVxuXG5mdW5jdGlvbiBjcmVhdGVQdWJsaXNoZXIoKTogYW55IHtcbiAgcmV0dXJuIG5ldyBQdWJsaXNoZXIoZW1pdHRlcik7XG59XG5cbmZ1bmN0aW9uIGNyZWF0ZVN1YnNjcmliZXIoKTogYW55IHtcbiAgcmV0dXJuIG5ldyBDb25zdW1lcihlbWl0dGVyKTtcbn1cblxuY29uc3QgRXZlbnRFbWl0dGVyTVEgPSB7XG4gIGNyZWF0ZVB1Ymxpc2hlcixcbiAgY3JlYXRlU3Vic2NyaWJlcixcbn07XG5cbmV4cG9ydCB7IEV2ZW50RW1pdHRlck1RIH07XG4iXSwibWFwcGluZ3MiOiI7Ozs7OztBQUFBO0FBQTRCO0FBRTVCLE1BQU1BLE9BQU8sR0FBRyxJQUFJQyxlQUFNLENBQUNDLFlBQVksRUFBRTtBQUN6QyxNQUFNQyxhQUFhLEdBQUcsSUFBSUMsR0FBRyxFQUFFO0FBRS9CLFNBQVNDLFdBQVcsQ0FBQ0MsT0FBZSxFQUFFO0VBQ3BDLElBQUksQ0FBQ0gsYUFBYSxDQUFDSSxHQUFHLENBQUNELE9BQU8sQ0FBQyxFQUFFO0lBQy9CO0lBQ0E7RUFDRjtFQUNBO0VBQ0FOLE9BQU8sQ0FBQ1EsY0FBYyxDQUFDRixPQUFPLEVBQUVILGFBQWEsQ0FBQ00sR0FBRyxDQUFDSCxPQUFPLENBQUMsQ0FBQztFQUMzREgsYUFBYSxDQUFDTyxNQUFNLENBQUNKLE9BQU8sQ0FBQztBQUMvQjtBQUVBLE1BQU1LLFNBQVMsQ0FBQztFQUdkQyxXQUFXLENBQUNaLE9BQVksRUFBRTtJQUN4QixJQUFJLENBQUNBLE9BQU8sR0FBR0EsT0FBTztFQUN4QjtFQUVBYSxPQUFPLENBQUNQLE9BQWUsRUFBRVEsT0FBZSxFQUFRO0lBQzlDLElBQUksQ0FBQ2QsT0FBTyxDQUFDZSxJQUFJLENBQUNULE9BQU8sRUFBRVEsT0FBTyxDQUFDO0VBQ3JDO0FBQ0Y7QUFFQSxNQUFNRSxRQUFRLFNBQVNmLGVBQU0sQ0FBQ0MsWUFBWSxDQUFDO0VBR3pDVSxXQUFXLENBQUNaLE9BQVksRUFBRTtJQUN4QixLQUFLLEVBQUU7SUFDUCxJQUFJLENBQUNBLE9BQU8sR0FBR0EsT0FBTztFQUN4QjtFQUVBaUIsU0FBUyxDQUFDWCxPQUFlLEVBQVE7SUFDL0JELFdBQVcsQ0FBQ0MsT0FBTyxDQUFDO0lBQ3BCLE1BQU1ZLE9BQU8sR0FBR0osT0FBTyxJQUFJO01BQ3pCLElBQUksQ0FBQ0MsSUFBSSxDQUFDLFNBQVMsRUFBRVQsT0FBTyxFQUFFUSxPQUFPLENBQUM7SUFDeEMsQ0FBQztJQUNEWCxhQUFhLENBQUNnQixHQUFHLENBQUNiLE9BQU8sRUFBRVksT0FBTyxDQUFDO0lBQ25DLElBQUksQ0FBQ2xCLE9BQU8sQ0FBQ29CLEVBQUUsQ0FBQ2QsT0FBTyxFQUFFWSxPQUFPLENBQUM7RUFDbkM7RUFFQWIsV0FBVyxDQUFDQyxPQUFlLEVBQVE7SUFDakNELFdBQVcsQ0FBQ0MsT0FBTyxDQUFDO0VBQ3RCO0FBQ0Y7QUFFQSxTQUFTZSxlQUFlLEdBQVE7RUFDOUIsT0FBTyxJQUFJVixTQUFTLENBQUNYLE9BQU8sQ0FBQztBQUMvQjtBQUVBLFNBQVNzQixnQkFBZ0IsR0FBUTtFQUMvQixPQUFPLElBQUlOLFFBQVEsQ0FBQ2hCLE9BQU8sQ0FBQztBQUM5QjtBQUVBLE1BQU11QixjQUFjLEdBQUc7RUFDckJGLGVBQWU7RUFDZkM7QUFDRixDQUFDO0FBQUMifQ==