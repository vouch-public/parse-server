"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.destroyAllDataPermanently = destroyAllDataPermanently;
var _cache = _interopRequireDefault(require("./cache"));
function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }
/**
 * Destroys all data in the database
 * @param {boolean} fast set to true if it's ok to just drop objects and not indexes.
 */
function destroyAllDataPermanently(fast) {
  if (!process.env.TESTING) {
    throw 'Only supported in test environment';
  }
  return Promise.all(Object.keys(_cache.default.cache).map(appId => {
    const app = _cache.default.get(appId);
    if (app.databaseController) {
      return app.databaseController.deleteEverything(fast);
    } else {
      return Promise.resolve();
    }
  }));
}
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJuYW1lcyI6WyJkZXN0cm95QWxsRGF0YVBlcm1hbmVudGx5IiwiZmFzdCIsInByb2Nlc3MiLCJlbnYiLCJURVNUSU5HIiwiUHJvbWlzZSIsImFsbCIsIk9iamVjdCIsImtleXMiLCJBcHBDYWNoZSIsImNhY2hlIiwibWFwIiwiYXBwSWQiLCJhcHAiLCJnZXQiLCJkYXRhYmFzZUNvbnRyb2xsZXIiLCJkZWxldGVFdmVyeXRoaW5nIiwicmVzb2x2ZSJdLCJzb3VyY2VzIjpbIi4uL3NyYy9UZXN0VXRpbHMuanMiXSwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IEFwcENhY2hlIGZyb20gJy4vY2FjaGUnO1xuXG4vKipcbiAqIERlc3Ryb3lzIGFsbCBkYXRhIGluIHRoZSBkYXRhYmFzZVxuICogQHBhcmFtIHtib29sZWFufSBmYXN0IHNldCB0byB0cnVlIGlmIGl0J3Mgb2sgdG8ganVzdCBkcm9wIG9iamVjdHMgYW5kIG5vdCBpbmRleGVzLlxuICovXG5leHBvcnQgZnVuY3Rpb24gZGVzdHJveUFsbERhdGFQZXJtYW5lbnRseShmYXN0KSB7XG4gIGlmICghcHJvY2Vzcy5lbnYuVEVTVElORykge1xuICAgIHRocm93ICdPbmx5IHN1cHBvcnRlZCBpbiB0ZXN0IGVudmlyb25tZW50JztcbiAgfVxuICByZXR1cm4gUHJvbWlzZS5hbGwoXG4gICAgT2JqZWN0LmtleXMoQXBwQ2FjaGUuY2FjaGUpLm1hcChhcHBJZCA9PiB7XG4gICAgICBjb25zdCBhcHAgPSBBcHBDYWNoZS5nZXQoYXBwSWQpO1xuICAgICAgaWYgKGFwcC5kYXRhYmFzZUNvbnRyb2xsZXIpIHtcbiAgICAgICAgcmV0dXJuIGFwcC5kYXRhYmFzZUNvbnRyb2xsZXIuZGVsZXRlRXZlcnl0aGluZyhmYXN0KTtcbiAgICAgIH0gZWxzZSB7XG4gICAgICAgIHJldHVybiBQcm9taXNlLnJlc29sdmUoKTtcbiAgICAgIH1cbiAgICB9KVxuICApO1xufVxuIl0sIm1hcHBpbmdzIjoiOzs7Ozs7QUFBQTtBQUErQjtBQUUvQjtBQUNBO0FBQ0E7QUFDQTtBQUNPLFNBQVNBLHlCQUF5QixDQUFDQyxJQUFJLEVBQUU7RUFDOUMsSUFBSSxDQUFDQyxPQUFPLENBQUNDLEdBQUcsQ0FBQ0MsT0FBTyxFQUFFO0lBQ3hCLE1BQU0sb0NBQW9DO0VBQzVDO0VBQ0EsT0FBT0MsT0FBTyxDQUFDQyxHQUFHLENBQ2hCQyxNQUFNLENBQUNDLElBQUksQ0FBQ0MsY0FBUSxDQUFDQyxLQUFLLENBQUMsQ0FBQ0MsR0FBRyxDQUFDQyxLQUFLLElBQUk7SUFDdkMsTUFBTUMsR0FBRyxHQUFHSixjQUFRLENBQUNLLEdBQUcsQ0FBQ0YsS0FBSyxDQUFDO0lBQy9CLElBQUlDLEdBQUcsQ0FBQ0Usa0JBQWtCLEVBQUU7TUFDMUIsT0FBT0YsR0FBRyxDQUFDRSxrQkFBa0IsQ0FBQ0MsZ0JBQWdCLENBQUNmLElBQUksQ0FBQztJQUN0RCxDQUFDLE1BQU07TUFDTCxPQUFPSSxPQUFPLENBQUNZLE9BQU8sRUFBRTtJQUMxQjtFQUNGLENBQUMsQ0FBQyxDQUNIO0FBQ0gifQ==